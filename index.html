<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Birthday Puzzle → Anagram → Surprise Game</title>
  <style>
    :root { --pink1:#ffe4e1; --pink2:#fff0f5; --accent:#d63384; --accent-dark:#b30059; --text:#333; --muted:#666; }
    *{box-sizing:border-box}
    body{
      font-family: Arial, sans-serif;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      min-height:100vh; margin:0; background:linear-gradient(to bottom, var(--pink1), var(--pink2));
    }
    h1{ color:var(--accent); text-align:center; padding:0 10px; margin:12px 0 6px }
    .screen{ width:100%; max-width:440px; padding:18px }
    .hidden{ display:none }
    .card{ background:#fff; border-radius:14px; padding:16px; box-shadow:0 10px 25px rgba(0,0,0,.08) }

    /* Welcome */
    #welcome-screen{
      position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
      background:linear-gradient(to bottom, #ffb6c1, #fff0f5); z-index:10; text-align:center; padding:20px
    }
    #welcome-screen h1{ font-size:2em; color:var(--accent-dark); margin-bottom:12px }
    #welcome-screen p{ font-size:1.1em; margin-bottom:18px; color:#444 }
    .btn{ margin:10px; padding:10px 20px; border:none; border-radius:10px; background:var(--accent); color:#fff; font-size:1em; cursor:pointer }
    .btn:active{ transform:translateY(1px) }
    .fade-out{ animation:fadeOut .5s ease forwards }
    @keyframes fadeOut{ to{ opacity:0; visibility:hidden } }

    /* Puzzle */
    #puzzle{ display:grid; gap:2px; margin-top:12px }
    .tile{ cursor:pointer; background-repeat:no-repeat; background-size:100% 100%; border-radius:6px; box-shadow:0 1px 2px rgba(0,0,0,.06) }
    #message{ margin-top:14px; font-size:1.05em; color:var(--text); max-width:360px; text-align:center }

    /* Anagram */
    #anagram-wrap{ display:flex; flex-direction:column; gap:10px }
    .zone-label{ font-size:.95em; color:var(--muted); margin:2px 2px 0 }
    .dropzone{
      min-height:56px; padding:10px; border:2px dashed #e4c6d6; border-radius:12px; background:#fff;
      display:flex; flex-wrap:wrap; gap:10px; justify-content:center; align-items:center;
      transition:border-color .2s, background .2s;
    }
    .dropzone.active{ border-color:var(--accent); background:#fff7fb }
    .chip{
      padding:10px 14px; border-radius:999px; background:#fff; box-shadow:0 6px 16px rgba(0,0,0,.09);
      border:1px solid rgba(0,0,0,.08); font-weight:bold; letter-spacing:1px; cursor:grab; user-select:none;
    }
    .chip:active{ cursor:grabbing }
    #result{ margin-top:8px; font-weight:bold; text-align:center }
    #reveal{ margin-top:14px; line-height:1.4; text-align:center }
    #reveal img{ width:100%; border-radius:14px; margin-top:12px; display:block }
    .row-actions{ display:flex; gap:10px; justify-content:center; margin-top:6px }
    .link-btn{ background:none; border:none; color:var(--accent-dark); text-decoration:underline; padding:6px 10px; cursor:pointer; font-size:.95em }

    /* Memory game */
    .memory-grid{
      display:grid; grid-template-columns:repeat(4, 1fr); gap:10px; justify-items:stretch;
    }
    @media (max-width:380px){
      .memory-grid{ grid-template-columns:repeat(3, 1fr); }
    }
    .memory-card{
      position:relative; width:100%; padding-top:120%; /* aspect ratio */ perspective:800px; cursor:pointer;
    }
    .memory-card .inner{
      position:absolute; inset:0; border-radius:12px; transition:transform .4s ease; transform-style:preserve-3d;
      box-shadow:0 8px 18px rgba(0,0,0,.08);
    }
    .memory-card.flipped .inner{ transform:rotateY(180deg); }
    .face{
      position:absolute; inset:0; border-radius:12px; display:flex; align-items:center; justify-content:center;
      backface-visibility:hidden; font-size:2rem; user-select:none;
    }
    .front{ background:#fff; border:1px solid rgba(0,0,0,.08); transform:rotateY(180deg); }
    .back{ background:linear-gradient(to bottom, #ffe4e1, #fff0f5); color:#b30059; font-weight:bold; }

    /* Word Search */
    .ws-wrap{ display:flex; flex-direction:column; gap:10px }
    .ws-grid{
      display:grid; grid-template-columns:repeat(12, 1fr); gap:4px; touch-action:none;
    }
    .ws-cell{
      background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:8px;
      width:100%; aspect-ratio:1 / 1; display:flex; align-items:center; justify-content:center;
      font-weight:bold; user-select:none;
    }
    .ws-cell.ws-selected{ background:#fff7fb; border-color:#e4c6d6 }
    .ws-cell.ws-found{ background:#d63384; color:#fff; border-color:#d63384 }
    .ws-words{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; font-size:.95em; color:#666 }
    .ws-words span{ padding:4px 8px; border-radius:999px; background:#f8e7f1 }
    .ws-words span.done{ background:#d63384; color:#fff; text-decoration:line-through }
  </style>
</head>
<body>

  <!-- Welcome Screen -->
  <div id="welcome-screen">
    <div class="card" style="max-width:480px;">
      <h1>🎂 Welcome to Your 21st Birthday App 🎂</h1>
      <p>Press continue to get started on your special birthday weekend 💖</p>
      <button class="btn" onclick="startApp()">Continue</button>
    </div>
  </div>

  <!-- Screen 1: Photo Puzzle -->
  <section id="puzzle-screen" class="screen">
    <h1>💖 Unscramble Our Photo 💖</h1>
    <div class="card" style="display:flex; flex-direction:column; align-items:center;">
      <div id="puzzle"></div>
      <div id="message">To get started, unlock this photo of us. Once it’s solved, it’ll take you to the next game to discover what we’re doing first 🎁</div>
    </div>
  </section>

  <!-- Screen 2: Word Search -->
  <section id="wordsearch-screen" class="screen hidden">
    <h1>🍳 Breakfast Word Search</h1>
    <div class="card">
      <p style="text-align:center; margin:0 0 8px">Drag to select words. Find them all to reveal the first plan!</p>
  
      <div class="ws-wrap">
        <div id="wsGrid" class="ws-grid" aria-label="Word search grid"></div>
        <div id="wsWords" class="ws-words"></div>
      </div>
  
      <div id="wsResult" style="text-align:center; margin-top:8px; font-weight:bold;"></div>
  
      <div id="reveal" class="hidden" style="margin-top:14px; text-align:center; line-height:1.4;">
        <p>🎉 Correct! We’re going to <strong>The Spence, Edinburgh</strong> for <strong>9:00 am</strong> — dress code: <strong>comfy & stylish</strong>.</p>
        <img id="spenceImg" alt="The Spence Edinburgh" style="width:100%; border-radius:14px; margin-top:12px; display:block;" />
        <button class="btn" id="continueCoaster" style="width:100%; margin-top:12px">Continue</button>
      </div>
    </div>
  </section>


  <!-- Screen 3: Surprise Game (Endless Runner) -->
  <section id="coaster-screen" class="screen hidden">
    <h1>🧩 Complete this to discover the next activity</h1>
    <div class="card" style="display:flex; flex-direction:column; align-items:center;">
      <canvas id="coasterCanvas" width="360" height="180" style="width:100%; max-width:360px; border-radius:12px; background:#eaf6ff"></canvas>
      <div id="coasterMsg" style="margin-top:10px; text-align:center; color:#333">
        Tap / click to jump. Clear 5 bumps to reveal the plan!
      </div>
      <div id="coasterReveal" class="hidden" style="margin-top:12px; text-align:center;">
        <p>🎉 Edinburgh <strong>Alpine Coaster</strong> booked at <strong>5</strong> — dress code: <strong>warm & comfortable</strong>.</p>
        <img src="alpine.jpg" alt="Alpine Coaster" style="width:100%; max-width:360px; border-radius:12px; margin-top:10px;" />
        <button class="btn" id="continueDinner" style="width:100%; margin-top:12px">Continue</button>
      </div>
    </div>
  </section>

  <!-- Screen 4: Food Matching Game -->
  <section id="memory-screen" class="screen hidden">
    <h1>🍽️ Match the foods to uncover tonight’s plan</h1>
    <div class="card">
      <div id="memoryGrid" class="memory-grid"></div>
      <div id="memoryMsg" style="text-align:center; margin-top:10px; color:#333">Find all 6 pairs.</div>
      <div id="memoryReveal" class="hidden" style="text-align:center; margin-top:12px;">
        <p>🎉 Well done! You’ve revealed you are going to <strong>Gaucho</strong> at <strong>9:15pm</strong> — dress to impress ✨</p>
        <img src="gaucho.jpg" alt="Gaucho" style="width:100%; max-width:420px; border-radius:12px; margin-top:10px;">
        <button class="btn" id="continueEnd" style="width:100%; margin-top:12px">Continue</button>
      </div>
    </div>
  </section>

  <!-- Screen 5: End of Day 1 -->
  <section id="end-screen" class="screen hidden">
    <h1>💞 Day 1 — Wrapped with love</h1>
    <div class="card" style="text-align:center;">
      <p style="margin:6px 0 10px;">
        Hope you have an amazing first day for your 21st — I love you 💖
      </p>

      <p style="margin:0 0 10px;">What do you fancy now?</p>
      <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
        <button class="btn" id="chooseBar">Go out to a bar/club 🍸</button>
        <button class="btn" id="chooseHome">Chill at home 🛋️</button>
      </div>

      <div id="choiceMsg" style="margin-top:12px; color:#333;"></div>

      <hr style="margin:16px 0; border:none; height:1px; background:#f1d3e0;">
      <p style="margin:0;">
        We’ll continue from next week — from <strong>Edinburgh</strong> to <strong>London</strong>,
        where we’ll have another jam-packed day with friends 🎉
      </p>

      <button class="btn" id="finishBtn" style="width:100%; margin-top:16px">Finish 🎂</button>
    </div>
  </section>

  <!-- Screen 6: Final Happy Birthday -->
  <section id="final-screen" class="screen hidden">
    <div class="card" style="text-align:center;">
      <h1 style="font-size:2em; color:#d63384; margin-bottom:10px;">🎉 Happy 21st Birthday! 🎉</h1>
      <p style="margin:0 0 12px; font-size:1.2em;">With all my love, forever 💖</p>
      <img src="Aryan.jpg" alt="Happy Birthday" style="width:100%; max-width:420px; border-radius:14px; margin-top:10px;">
    </div>
  </section>

  <script>
    /* ---------- Welcome ---------- */
    function startApp(){
      const w = document.getElementById("welcome-screen");
      w.classList.add("fade-out");
      setTimeout(()=>{ w.style.display="none"; }, 480);
    }

    /* ---------- Photo Puzzle ---------- */
    const rows = 4, cols = 4;
    const puzzle = document.getElementById('puzzle');
    const img = new Image();
    img.src = "IMG_4778.jpg"; // your image file
    img.onload = () => {
      const maxW = Math.min(360, window.innerWidth - 40);
      const w = maxW;
      const h = (img.height / img.width) * w;
      puzzle.style.width = w + "px";
      puzzle.style.height = h + "px";
      puzzle.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      puzzle.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

      const total = rows * cols;
      let order = [...Array(total).keys()];

      function createTiles() {
        puzzle.innerHTML = '';
        order.forEach((tileIndex, pos) => {
          const div = document.createElement('div');
          div.className = 'tile';
          div.style.width = (w / cols) + "px";
          div.style.height = (h / rows) + "px";
          div.style.backgroundImage = "url(" + img.src + ")";
          const r = Math.floor(tileIndex / cols);
          const c = tileIndex % cols;
          div.style.backgroundSize = `${w}px ${h}px`;
          div.style.backgroundPosition = `${-c * (w / cols)}px ${-r * (h / rows)}px`;
          div.addEventListener('click', () => onTileClick(pos));
          puzzle.appendChild(div);
        });
      }

      let selected = null;
      function onTileClick(pos) {
        if (selected === null) {
          selected = pos;
        } else if (selected === pos) {
          selected = null;
        } else {
          [order[selected], order[pos]] = [order[pos], order[selected]];
          selected = null;
          createTiles();
          checkSolved();
        }
      }

      function shuffle() {
        for (let i = order.length - 1; i > 0; i--){
          const j = Math.floor(Math.random() * (i + 1));
          [order[i], order[j]] = [order[j], order[i]];
        }
        if (order.every((v,i)=>v===i)) shuffle(); // avoid already-solved
        createTiles();
      }

      function checkSolved() {
        if (order.every((v,i) => v===i)) {
          document.getElementById('message').innerText = '🎉 Nice! Unlocking your first game…';
          setTimeout(()=> {
            document.getElementById('puzzle-screen').classList.add('hidden');
            startWordSearch(); // initialize next game
            document.getElementById('wordsearch-screen').classList.remove('hidden');
          }, 900);
        }
      }

      shuffle();
    };

      /* ---------- Word Search (drag-to-select) ---------- */
      function startWordSearch(){
        const WORDS = ["BRUNCH","EGGS","BACON","PANCAKES","COFFEE","TOAST"];
        const size = 12; // 12x12 grid
        const grid = Array.from({length:size}, ()=>Array(size).fill(null));
        const used = new Set();
      
        // Directions: row,col deltas
        const DIRS = [
          [0,1],[1,0],[0,-1],[-1,0],  // horiz & vert
          [1,1],[1,-1],[-1,1],[-1,-1] // diagonals
        ];
      
        function placeWord(word){
          for (let attempts=0; attempts<400; attempts++){
            const dir = DIRS[Math.floor(Math.random()*DIRS.length)];
            const dr = dir[0], dc = dir[1];
            const maxR = dr===1 ? size - word.length : dr===-1 ? word.length-1 : size-1;
            const minR = dr===-1 ? word.length-1 : 0;
            const maxC = dc===1 ? size - word.length : dc===-1 ? word.length-1 : size-1;
            const minC = dc===-1 ? word.length-1 : 0;
      
            const r0 = Math.floor(Math.random()*(maxR-minR+1))+minR;
            const c0 = Math.floor(Math.random()*(maxC-minC+1))+minC;
      
            let ok = true;
            for (let i=0;i<word.length;i++){
              const r = r0 + dr*i, c = c0 + dc*i;
              const cell = grid[r][c];
              if (cell && cell !== word[i]) { ok = false; break; }
            }
            if (!ok) continue;
      
            for (let i=0;i<word.length;i++){
              const r = r0 + dr*i, c = c0 + dc*i;
              grid[r][c] = word[i];
              used.add(r+','+c);
            }
            return true;
          }
          return false;
        }
      
        // Place words
        WORDS.forEach(w=>placeWord(w));
      
        // Fill remaining with random letters
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        for (let r=0;r<size;r++){
          for (let c=0;c<size;c++){
            if (!grid[r][c]) grid[r][c] = alphabet[Math.floor(Math.random()*alphabet.length)];
          }
        }
      
        // Render list
        const wsWords = document.getElementById('wsWords');
        wsWords.innerHTML = '';
        WORDS.forEach(w=>{
          const tag = document.createElement('span');
          tag.textContent = w;
          tag.id = 'word_'+w;
          wsWords.appendChild(tag);
        });
      
        // Render grid
        const wsGrid = document.getElementById('wsGrid');
        wsGrid.innerHTML = '';
        const cells = []; // keep refs
        for (let r=0;r<size;r++){
          for (let c=0;c<size;c++){
            const div = document.createElement('div');
            div.className = 'ws-cell';
            div.textContent = grid[r][c];
            div.dataset.r = r; div.dataset.c = c;
            wsGrid.appendChild(div);
            cells.push(div);
          }
        }
      
        // Selection logic (drag in a straight line)
        let selecting = false;
        let start = null;
        let dir = null;
        let trail = [];
      
        const resetSelection = () => {
          trail.forEach(el=>el.classList.remove('ws-selected'));
          trail = []; dir = null; start = null; selecting = false;
        };
      
        function onPointerDown(e){
          const t = e.target.closest('.ws-cell'); if (!t) return;
          selecting = true;
          start = t;
          trail = [t];
          t.classList.add('ws-selected');
        }
        function onPointerEnter(e){
          if (!selecting) return;
          const t = e.target.closest('.ws-cell'); if (!t || trail.includes(t)) return;
      
          const r0 = +start.dataset.r, c0 = +start.dataset.c;
          const r1 = +t.dataset.r, c1 = +t.dataset.c;
          const dr = Math.sign(r1 - r0), dc = Math.sign(c1 - c0);
      
          // Lock direction after second cell
          if (!dir){
            // ensure straight line (8 dirs only)
            if (!((r1===r0)||(c1===c0)||Math.abs(r1-r0)===Math.abs(c1-c0))) return;
            dir = [dr, dc];
          } else {
            if (dr !== dir[0] || dc !== dir[1]) return;
          }
      
          // Ensure cell is the exact next in line
          const last = trail[trail.length-1];
          const lr = +last.dataset.r + dir[0];
          const lc = +last.dataset.c + dir[1];
          if (r1 !== lr || c1 !== lc) return;
      
          t.classList.add('ws-selected');
          trail.push(t);
        }
        function onPointerUp(){
          if (!selecting) return;
          const picked = trail.map(el=>el.textContent).join('');
          const rev = picked.split('').reverse().join('');
      
          let found = null;
          for (const w of WORDS){
            const tag = document.getElementById('word_'+w);
            if (tag.classList.contains('done')) continue;
            if (w === picked || w === rev){ found = w; break; }
          }
      
          if (found){
            trail.forEach(el=>{ el.classList.remove('ws-selected'); el.classList.add('ws-found'); el.dataset.locked='1'; });
            document.getElementById('word_'+found).classList.add('done');
            const doneCount = [...document.querySelectorAll('.ws-words span.done')].length;
            document.getElementById('wsResult').textContent = `Nice! Found ${doneCount}/${WORDS.length}`;
            if (doneCount === WORDS.length){
              // Reveal same as before
              const spence = localStorage.getItem(KEYS.spence);
              const spenceImg = document.getElementById('spenceImg');
              if (spence) spenceImg.src = spence;
              document.getElementById('reveal').classList.remove('hidden');
              confetti();
            }
          } else {
            // Not a word → just clear selection
            trail.forEach(el=>el.classList.remove('ws-selected'));
          }
      
          trail = []; dir = null; start = null; selecting = false;
        }
      
        // Pointer events (works for mouse + touch)
        wsGrid.addEventListener('pointerdown', onPointerDown);
        wsGrid.addEventListener('pointerenter', onPointerEnter, true);
        window.addEventListener('pointerup', onPointerUp);
      }
    

    /* --------- Surprise Game (Endless Runner with Emoji + Bounce) --------- */
    function startCoasterGame(){
      const canvas = document.getElementById('coasterCanvas');
      const ctx = canvas.getContext('2d');

      const W = canvas.width, H = canvas.height;
      const groundY = H - 30;

      // Player (emoji cart)
      const cart = { x: 40, y: groundY - 22, w: 28, h: 22, vy: 0 };
      const gravity = 0.6;
      const jump = -9.5;
      let canJump = true;

      // Obstacles (bumps)
      const obstacles = [];
      let frame = 0;
      let speed = 3;
      let cleared = 0;
      const GOAL = 5; // need 5 bumps cleared
      let gameOver = false;
      let running = true;

      // Input: tap/click/space to jump
      const jumpAction = () => {
        if (!running || gameOver) return;
        if (canJump) { cart.vy = jump; canJump = false; }
      };
      canvas.addEventListener('mousedown', jumpAction);
      canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); jumpAction(); }, {passive:false});
      window.addEventListener('keydown', (e)=>{ if (e.code === 'Space') jumpAction(); });

      function spawnObstacle(){
        const w = 14 + Math.floor(Math.random()*8);
        const h = 8 + Math.floor(Math.random()*8);
        obstacles.push({ x: W + 10, y: groundY - h, w, h, counted:false });
      }

      function reset(){
        obstacles.length = 0;
        frame = 0; speed = 3; cleared = 0; gameOver = false; running = true;
        cart.x = 40; cart.y = groundY - cart.h; cart.vy = 0; canJump = true;
        document.getElementById('coasterMsg').textContent = `Tap / click to jump. Clear ${GOAL} bumps to reveal the plan!`;
        document.getElementById('coasterReveal').classList.add('hidden');
        loop();
      }

      function win(){
        running = false;
        document.getElementById('coasterMsg').textContent = 'Nice driving!';
        document.getElementById('coasterReveal').classList.remove('hidden');
        if (typeof confetti === 'function') {
          confetti({ particleCount: 160, spread: 70, origin: { y: 0.6 } });
        }
      }

      function lose(){
        gameOver = true;
        running = false;
        document.getElementById('coasterMsg').innerHTML = 'Oops! You hit a bump. <button class="link-btn" id="retryBtn" type="button">Retry</button>';
        setTimeout(()=>{
          const r = document.getElementById('retryBtn');
          if (r) r.onclick = reset;
        }, 0);
      }

      function update(){
        frame++;

        // Spawn bumps every ~90–110 frames
        if (frame % Math.floor(90 + Math.random()*20) === 0){
          spawnObstacle();
          speed = Math.min(5.5, speed + 0.15);
        }

        // Physics
        cart.vy += gravity;
        cart.y += cart.vy;
        if (cart.y + cart.h >= groundY){
          cart.y = groundY - cart.h;
          cart.vy = 0;
          canJump = true;
        }

        // Move obstacles & detect pass/collision
        for (let i = obstacles.length - 1; i >= 0; i--){
          const o = obstacles[i];
          o.x -= speed;

          if (!o.counted && o.x + o.w < cart.x){
            o.counted = true;
            cleared++;
            document.getElementById('coasterMsg').textContent = `Great! Bumps cleared: ${cleared}/${GOAL}`;
            if (cleared >= GOAL) return win();
          }

          if (rectsOverlap(cart, o)) return lose();

          if (o.x + o.w < -20) obstacles.splice(i, 1);
        }
      }

      function rectsOverlap(a,b){
        return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
      }

      function draw(){
        // Sky
        ctx.fillStyle = '#eaf6ff';
        ctx.fillRect(0,0,W,H);

        // Ground
        ctx.fillStyle = '#b2d9ff';
        ctx.fillRect(0, groundY, W, H - groundY);

        // Track line (wavy)
        ctx.strokeStyle = '#5aa9e6';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(0, groundY);
        for (let x = 0; x <= W; x += 10){
          const y = groundY + Math.sin((frame + x)*0.02)*2;
          ctx.lineTo(x, y);
        }
        ctx.stroke();

        // Obstacles (bumps)
        ctx.fillStyle = '#5aa9e6';
        obstacles.forEach(o=>{
          ctx.fillRect(o.x, o.y, o.w, o.h);
        });

        // Emoji cart 🛷 with bounce
        const baseSize = 24;
        const extra = Math.max(0, -cart.vy) * 0.8;
        const size = Math.min(36, baseSize + extra);
        ctx.font = `${size}px "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif`;
        ctx.textBaseline = 'bottom';
        ctx.fillText('🛷', cart.x, cart.y + cart.h);
      }

      function loop(){
        if (!running) return;
        update();
        draw();
        requestAnimationFrame(loop);
      }

      reset(); // start
    }

    /* --------- Food Matching Game --------- */
    document.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'continueDinner') {
        document.getElementById('coaster-screen').classList.add('hidden');
        document.getElementById('memory-screen').classList.remove('hidden');
        startMemoryGame();
      }
    });

    function startMemoryGame(){
      const grid = document.getElementById('memoryGrid');
      const msg  = document.getElementById('memoryMsg');
      const reveal = document.getElementById('memoryReveal');

      const items = ['🍷','🍗','🐟','🥗','🍝','🍰']; // 6 items (no steak)
      const deck = shuffleArray([...items, ...items]); // 12 cards

      let first = null, second = null, lock = false, matches = 0;

      grid.innerHTML = '';
      reveal.classList.add('hidden');
      msg.textContent = 'Find all 6 pairs.';

      deck.forEach((symbol) => {
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.dataset.symbol = symbol;

        card.innerHTML = `
          <div class="inner">
            <div class="face front">${symbol}</div>
            <div class="face back">🍽️</div>
          </div>
        `;

        card.addEventListener('click', () => {
          if (lock || card.classList.contains('matched') || card === first) return;
          card.classList.add('flipped');

          if (!first) {
            first = card;
          } else {
            second = card;
            lock = true;

            if (first.dataset.symbol === second.dataset.symbol) {
              setTimeout(() => {
                first.classList.add('matched');
                second.classList.add('matched');
                first = second = null;
                lock = false;
                matches++;
                msg.textContent = `Nice! Pairs found: ${matches}/6`;

                if (matches === 6) {
                  msg.textContent = 'Delicious! All pairs matched.';
                  reveal.classList.remove('hidden');
                  if (typeof confetti === 'function') {
                    confetti({ particleCount: 180, spread: 70, origin: { y: 0.6 } });
                  }
                }
              }, 350);
            } else {
              setTimeout(() => {
                first.classList.remove('flipped');
                second.classList.remove('flipped');
                first = second = null;
                lock = false;
              }, 700);
            }
          }
        });

        grid.appendChild(card);
      });

      function shuffleArray(arr){
        for (let i = arr.length - 1; i > 0; i--){
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }
    }

    /* --------- End Screen Navigation + Choices --------- */
    // Move to End Screen after dinner reveal
    document.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'continueEnd') {
        document.getElementById('memory-screen').classList.add('hidden');
        document.getElementById('end-screen').classList.remove('hidden');
        if (typeof confetti === 'function') {
          confetti({ particleCount: 160, spread: 70, origin: { y: 0.6 } });
        }
      }
    });

    // Handle end-screen choices
    document.addEventListener('click', (e) => {
      const msg = document.getElementById('choiceMsg');
      if (!msg) return;

      if (e.target && e.target.id === 'chooseBar') {
        msg.textContent = "Perfect — let’s dress up and find a vibe ✨";
      }
      if (e.target && e.target.id === 'chooseHome') {
        msg.textContent = "Cosy night it is — PJs, snacks, and cuddles 🫶";
      }
    });

    // Move to Final Happy Birthday screen
    document.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'finishBtn') {
        document.getElementById('end-screen').classList.add('hidden');
        document.getElementById('final-screen').classList.remove('hidden');

        // Confetti burst for ~2 seconds
        if (typeof confetti === 'function') {
          const duration = 2000;
          const end = Date.now() + duration;
          (function frame() {
            confetti({ particleCount: 6, angle: 60, spread: 55, origin: { x: 0 } });
            confetti({ particleCount: 6, angle: 120, spread: 55, origin: { x: 1 } });
            if (Date.now() < end) requestAnimationFrame(frame);
          })();
        }
      }
    });
  </script>

  <!-- Confetti (used in anagram success + game wins + finale) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</body>
</html>
